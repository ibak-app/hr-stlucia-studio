<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Record Video Resume — Talent by St. Lucia Studio</title>
  <meta name="theme-color" content="#000000">
  <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    body { background: #000; }

    .video-page {
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      background: #000;
      color: #fff;
    }

    .video-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--spacing-md);
      z-index: 10;
      background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
    }
    .video-nav a { color: #fff; font-weight: 600; font-size: 14px; }
    .video-nav__title { font-size: 15px; font-weight: 600; }

    .video-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding-top: 56px;
    }

    /* Question Selector */
    .question-bar {
      padding: var(--spacing-sm) var(--spacing-md);
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .question-bar::-webkit-scrollbar { display: none; }
    .question-bar .tag {
      display: inline-flex;
      background: rgba(255,255,255,0.15);
      color: rgba(255,255,255,0.8);
      font-size: 12px;
      margin-right: 6px;
      cursor: pointer;
    }
    .question-bar .tag--selected {
      background: var(--accent);
      color: var(--text);
    }

    /* Camera Area */
    .camera-area {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #111;
    }
    .camera-area video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #camera-preview {
      transform: scaleX(-1); /* mirror front camera */
    }

    /* Prompt Overlay */
    .prompt-overlay {
      position: absolute;
      top: var(--spacing-md);
      left: var(--spacing-md);
      right: var(--spacing-md);
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      text-align: center;
      font-size: 15px;
      line-height: 1.5;
    }

    /* Timer */
    .timer {
      position: absolute;
      top: var(--spacing-md);
      right: var(--spacing-md);
      background: rgba(0,0,0,0.6);
      padding: 4px 12px;
      border-radius: var(--radius-pill);
      font-size: 14px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }
    .timer.recording {
      background: rgba(239,71,111,0.9);
      animation: pulse 1.5s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Countdown */
    .countdown {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
      font-weight: 800;
      color: #fff;
      background: rgba(0,0,0,0.5);
      z-index: 5;
    }

    /* Controls */
    .video-controls-bar {
      padding: var(--spacing-lg) var(--spacing-md);
      padding-bottom: calc(var(--spacing-lg) + env(safe-area-inset-bottom, 0));
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xl);
    }

    .ctrl-btn {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: rgba(255,255,255,0.15);
      border: none;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
    }
    .ctrl-btn:hover { background: rgba(255,255,255,0.25); }

    .record-btn {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      border: 4px solid #fff;
      background: transparent;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }
    .record-btn::after {
      content: '';
      position: absolute;
      inset: 6px;
      border-radius: 50%;
      background: #EF476F;
      transition: all 0.2s;
    }

    .stop-btn {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      border: 4px solid #fff;
      background: transparent;
      cursor: pointer;
      position: relative;
    }
    .stop-btn::after {
      content: '';
      position: absolute;
      inset: 18px;
      border-radius: 4px;
      background: #EF476F;
    }

    /* Preview Screen */
    .preview-controls {
      padding: var(--spacing-md);
      padding-bottom: calc(var(--spacing-md) + env(safe-area-inset-bottom, 0));
      background: rgba(0,0,0,0.85);
      display: flex;
      gap: var(--spacing-sm);
    }
    .preview-controls .btn { flex: 1; }

    /* Permission / Error screens */
    .message-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: var(--spacing-xl);
    }
    .message-screen h2 { color: #fff; margin-bottom: var(--spacing-sm); }
    .message-screen p {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      margin-bottom: var(--spacing-lg);
      max-width: 320px;
    }
    .message-screen .btn { min-width: 200px; }
    .message-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: var(--spacing-lg);
      color: var(--accent);
    }
  </style>
  <!-- Analytics: Plausible -->
  <script defer data-domain="talent.stlucia.studio" src="https://plausible.io/js/script.js"></script>
  <!-- Analytics: Facebook Pixel (replace YOUR_PIXEL_ID) -->
  <script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init','YOUR_PIXEL_ID');fbq('track','PageView');</script>
</head>
<body>

  <div class="video-page">

    <!-- Top Nav -->
    <div class="video-nav">
      <a href="dashboard.html">&larr; Back</a>
      <span class="video-nav__title">Video Resume</span>
      <button type="button" class="ctrl-btn" id="upload-btn" title="Upload video" style="width:36px;height:36px;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
      </button>
      <input type="file" accept="video/*" id="upload-input" class="hidden">
    </div>

    <div class="video-body">

      <!-- Question Selector -->
      <div class="question-bar">
        <button type="button" class="tag tag--selected" data-question="0">Intro</button>
        <button type="button" class="tag" data-question="1">Skills</button>
        <button type="button" class="tag" data-question="2">Why St. Lucia</button>
        <button type="button" class="tag" data-question="3">Challenge</button>
        <button type="button" class="tag" data-question="4">Goals</button>
      </div>

      <!-- Recording Screen -->
      <div id="record-screen">
        <div class="camera-area">
          <video id="camera-preview" autoplay playsinline muted></video>

          <div class="prompt-overlay">
            <span id="video-prompt-text">Tell us about yourself — who are you and what do you do?</span>
          </div>

          <div class="timer" id="timer-display">1:30</div>

          <div class="countdown hidden" id="countdown">3</div>
        </div>

        <div class="video-controls-bar">
          <button type="button" class="ctrl-btn" id="flip-btn" title="Flip camera">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><polyline points="23 20 23 14 17 14"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/></svg>
          </button>

          <button type="button" class="record-btn" id="record-btn" title="Start recording"></button>
          <button type="button" class="stop-btn hidden" id="stop-btn" title="Stop recording"></button>

          <div style="width:48px;"></div>
        </div>
      </div>

      <!-- Preview Screen -->
      <div id="preview-screen" class="hidden">
        <div class="camera-area">
          <video id="video-playback" controls playsinline></video>
        </div>

        <div class="preview-controls">
          <button type="button" class="btn btn--outline-white" id="retake-btn">Retake</button>
          <button type="button" class="btn btn--accent" id="submit-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
            Save Video
          </button>
        </div>
      </div>

      <!-- Permission Screen -->
      <div id="permission-screen" class="hidden">
        <div class="message-screen">
          <div class="message-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>
          </div>
          <h2>Camera Access Needed</h2>
          <p>To record your video resume, we need access to your camera and microphone. Please allow access in your browser settings and reload.</p>
          <button type="button" class="btn btn--accent" onclick="location.reload()">Try Again</button>
          <p style="margin-top: var(--spacing-md);">Or <button type="button" style="background:none;border:none;color:var(--accent);cursor:pointer;font-family:inherit;font-size:inherit;text-decoration:underline;" onclick="document.getElementById('upload-input').click()">upload a video</button> instead.</p>
        </div>
      </div>

      <!-- Error Screen -->
      <div id="error-screen" class="hidden">
        <div class="message-screen">
          <div class="message-icon" style="color: var(--error);">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
          </div>
          <h2>Something went wrong</h2>
          <p id="error-message">Could not access the camera.</p>
          <button type="button" class="btn btn--accent" onclick="location.reload()">Try Again</button>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="assets/js/supabase.js"></script>
  <script src="assets/js/app.js"></script>
  <script src="assets/js/analytics.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/video.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      App.requireAuth('video.html');
      App.onAuthReady(function(user) {
        if (user) VideoRecorder.init();
      });
    });
  </script>

</body>
</html>
